{% for w in result['codeCoverageWarnings'] -%}
	{% if w['name'] == None -%}
	<div class="alert-message block-message error">
		<p><strong>{{ w['message'] }}</strong></p>
	</div>
	{%- endif %}
{%- endfor %}

{% for cls, tests in result['results_normal'].items() -%}
		
	<div class="alert-message block-message-custom" style="margin-bottom:0px;padding: 5px;-webkit-border-radius: 4px 4px 0px 0px;">
			<p style="float:left;"><strong>{{ cls }}.cls</strong></p>
			<p style="float:right;"><strong>{{ result['pass_fail'][cls]['pass'] }}/{{ result['pass_fail'][cls]['pass']+result['pass_fail'][cls]['fail'] }}&nbsp;tests passed</strong></p>
		<div style="clear:both;"></div>	
	</div>
	<table class="bordered-table test_result" style="-webkit-border-radius: 0px 0px 4px 4px;">
		<thead>
			<tr>
				<th>Test Method</th>
				<th>Result</th>
				<th>Message</th>
			</tr>
		</thead>
		<tbody>
			{% for test in tests -%}
				<tr>
					<td style="width:210px;">{{ test['methodName'] }}</td>
					<td style="width:45px;">
						{% if 'stackTrace' not in test -%}
							<span class="label success">Passed</span>
						{% else %}
							<span class="label important">Failed</span>
						{%- endif %}
					</td>
					<td>
						{% if 'message' in test %}
							{{ test['message'] }} 
						{% endif %}
						{% if 'stackTrace' in test -%}
							&nbsp;<a onclick="$('#modal_{{ loop.index }}').modal('toggle')" href="#">[Stack Trace]</a>
							<div class="modal" style="display:none;" id="modal_{{ loop.index }}">
								<div class="modal-header">
					            	<a href="#" class="close">Ã—</a>
					            	<h3>Stack Trace</h3>
					          	</div>
								<div class="modal-body">
									<div style="height:190px;overflow-y:auto;">
										{{ test['stackTrace'] }}
									</div>
					          	</div>
								<div class="modal-footer">
									<a href="#" onclick="$('#modal_{{ loop.index }}').modal().close()" class="btn primary">OK</a>
								</div>
							</div>
						{%- endif %}
					</td>
				</tr>
			{%- endfor %}
		</tbody>
	</table>
{%- endfor %} 

<div id="warnings_wrapper">
	<!--  WARNINGS -->
	<div class="alert-message block-message-custom" style="margin-bottom:0px;padding: 5px;-webkit-border-radius: 4px 4px 0px 0px;">
			<p style="float:left;"><strong>Test Coverage Warnings</strong></p>
		<div style="clear:both;"></div>	
	</div>
	<table class="bordered-table test_result" style="-webkit-border-radius: 0px 0px 4px 4px;">
		<thead>
			<tr>
				<th>Metadata</th>
				<th>Message</th>
			</tr>
		</thead>
		<tbody>
			{% for w in result['codeCoverageWarnings'] %}
				{% if 'name' in w and w['name'] != None %}
					<tr>
						<td>{{ w['name'] }}</td>					
						<td>{{ w['message'] }}</td>					
					</tr>   
				{% endif %}
			{% endfor %}
		</tbody>
	</table>  
	<!-- END WARNINGS -->
</div>


<div id="class_wrapper">
	<!-- START CLASS PROCESSING -->
	{% for r in result['codeCoverage']['classes'] -%}
		{% set coverage = r['percentCovered'] %}
		{% set coverage_class = r['coverageLevel'] %}
		{% set display = "block" %}
		{% set extension = "cls"  %}
		{% set directory = "classes" %}

	<div class="alert-message block-message-custom " style="padding: 0px 5px 5px 5px;">
	  	<div style="margin-bottom:10px;">
			<p style="float:left;"><strong>{{ r['name'] }}.{{ extension }}</strong></p>
			<p style="float:right;"><strong></strong></p>
		</div>
		<div style="clear:both;"></div>
		<p style="margin-bottom:10px;">
			<div id="progress_bar" class="ui-progress-bar{{ " " }}ui-container" style="-webkit-border-radius: 8px;height: 22px;">
	      		<div class="ui-progress{{ " " }}{{ coverage_class }}" style="-webkit-border-radius:8px;height:20px;width: {{ coverage }}%; display: {{ display }}; ">
	        		<span style="font-size: 1.1em;line-height: 21px;" class="ui-label{{ " " }}{{ coverage_class }}">{{ coverage }}%</span>
	      		</div>
	    	</div>
		</p>
	  	<div class="alert-actions">
	    	<a href="#" class="btn primary" data-toggle="toggle" 
				onclick="toggleSourceButton(this, {{ loop.index }}, 'class')" style="padding: 3px 5px;font-size: .9em;">View Coverage</a>
		</div>
	</div>

		{% if does_file_exist(r['name'], 'ApexClass') == True -%}
		<table class='code' id="class_code_result_{{ loop.index }}">
			<tbody>
				{% for line in get_file_lines(r['name'], 'ApexClass') -%} 
					{% set file_line_number = loop.index %}
					{% set td_class = [] %}
					{% if 'locationsNotCovered' in r -%}
						{% for location in r['locationsNotCovered'] -%}
							{% if 'line' in location %}
								{% if location['line']|int == file_line_number -%}
									{% if td_class.append(1) %}{% endif %}
									{% break %}
								{%- endif %}
							{% endif %}
						{%- endfor %}
					{%- endif %}
					
					{% if td_class -%}
					   	<tr>
					    	<td class="line_numbers">{{ file_line_number }}</td>
					    	<td class="code not_covered">{{ htmlize(line) }}</td>
						</tr>
					{% else %}
						<tr>
					    	<td class="line_numbers">{{ file_line_number }}</td>
					    	<td class="code covered"> {{ htmlize(line) }} </td>
						</tr>
					{%- endif %}
					
				{%- endfor %}
			</tbody>
		</table>
		{%- endif %}

	{%- endfor %} 
	<!-- END CLASS PROCESSING --> 
</div>

<div id="trigger_wrapper">
	<!-- START TRIGGER PROCESSING -->
	{% for r in result['codeCoverage']['triggers'] -%}
		{% set coverage = r['percentCovered'] %}
		{% set coverage_class = r['coverageLevel'] %}
		{% set display = "block" %}
		{% set extension = "trigger"  %}
		{% set directory = "triggers" %}

	<div class="alert-message block-message-custom " style="padding: 0px 5px 5px 5px;">
	  	<div style="margin-bottom:10px;">
			<p style="float:left;"><strong>{{ r['name'] }}.{{ extension }}</strong></p>
			<p style="float:right;"><strong></strong></p>
		</div>
		<div style="clear:both;"></div>
		<p style="margin-bottom:10px;">
			<div id="progress_bar" class="ui-progress-bar{{ " " }}ui-container" style="-webkit-border-radius: 8px;height: 22px;">
	      		<div class="ui-progress{{ " " }}{{ coverage_class }}" style="-webkit-border-radius:8px;height:20px;width: {{ coverage }}%; display: {{ display }}; ">
	        		<span style="font-size: 1.1em;line-height: 21px;" class="ui-label{{ " " }}{{ coverage_class }}">{{ coverage }}%</span>
	      		</div>
	    	</div>
		</p>
	  	<div class="alert-actions">
	    	<a href="#" class="btn primary" data-toggle="toggle" 
				onclick="toggleSourceButton(this, {{ loop.index }}, 'trigger')" style="padding: 3px 5px;font-size: .9em;">View Coverage</a>
		</div>
	</div>

		{% if does_file_exist(r['name'], 'ApexTrigger') == True -%}
		<table class='code' id="trigger_code_result_{{ loop.index }}">
			<tbody>
				{% for line in get_file_lines(r['name'], 'ApexTrigger') -%} 
					{% set file_line_number = loop.index %}
					{% set td_class = [] %}
					{% if 'locationsNotCovered' in r -%}
						{% for location in r['locationsNotCovered'] -%}
							{% if 'line' in location %}
								{% if location['line']|int == file_line_number %}
									{% if td_class.append(1) %}{% endif %}
									{% break %}
								{% endif %}
							{% endif %}
						{%- endfor %}
					{%- endif %}
					
					{% if td_class -%}
					   	<tr>
					    	<td class="line_numbers">{{ file_line_number }}</td>
					    	<td class="code not_covered">{{ htmlize(line) }}</td>
						</tr>
					{% else %}
						<tr>
					    	<td class="line_numbers">{{ file_line_number }}</td>
					    	<td class="code covered">{{ htmlize(line) }}</td>
						</tr>
					{%- endif %}
				{%- endfor %}
			</tbody>
		</table>
		{%- endif %}

	{%- endfor %} 
	<!-- END TRIGGER PROCESSING --> 
</div>


<div id="log_wrapper" style="position:relative;">
	<a href="javascript:void(0)" class="btn primary" onclick="$('#log_selector').selectText();" style="padding: 3px 5px;font-size: .9em;top:0;right:10px;position:absolute;">Select Log Text</a>
	<div style="padding:10px;" id="log_selector">
		{{ htmlize(result['log']) }}
	</div>
</div>
